# **基本配置**

### innodb_buffer_pool_size

数据和索引缓存的地方，这个值越大越好，保证大多数的读取操作使用的是内存不是硬盘。

典型的配置 5-6GB(8GB)、20-25GB(32gb)、100-120GB(128GB)。

 

### innodb_log_file_size

这个是redo日志的大小。redo用于提高写操作快速而可靠和崩溃时的恢复。

一直到msyql5.1，这个参数都难于调整，因为一方想调大提高写性能，另一方想调小使得崩溃后恢复更快。

幸运的是，在5.5之后，崩溃恢复的性能得到提升，这样可以同时拥有较高的写入性能和崩溃恢复性能了。

一直到mysql5.5，redo日志的总尺寸限定为4GB(默认有两个log文件)。

如果程序要频繁的写入数据并且用的5.6版本，那么可以一开始就写4G。

 

### max_connections

该值被设置高了(例如1000或更高)之后的一个主要缺陷是但服务器运行1000个或者更高的活动事务时会变得没有响应。

 

# **innodb****配置**

### innodb_file_per_table

本设置是告诉innodb是否需要将所有表的数据和索引存放到共享表空间里。

= ON 每张表的数据单独放在一个.idb文件。

每张表一个文件是，允许在drop，truncate或者rebuild表时回收磁盘空间。

不想每个表一个文件的主要场景是表非常多，比如10k+。

5.6版本默认是on，大部分情况不用修改，但是之前的版本需要在加载数据前修改为ON，因为它只对新建的表有影响。

 

### innodb_flush_log_at_trx_commit

默认值为1，表示innodb完全支持ACID特性。关注数据安全时，这个值最合适，但会对磁盘读写慢的系统带来巨大的开销，因为每次将改变刷新到redo日志时需要额外的同步操作(fsyncs)。

值为2，导致数据不太可靠，因为提交的事务仅仅每秒才刷新一次到redo日志，备份节点可以接受这个值。

值为0，速度更快，但是系统崩溃时可能丢失数据，备份节点可以这么设置。

 

### innodb_flush_method

配置数据和日志写入硬盘的方式。

默认值fdatasync

如果有硬件RAID控制器，并且其独立缓存采用write-back机制，并有着电池断电保护，那么应该设置为O_DIRECT

 

### innodb_log_buffer_size

为尚未执行的事务分配的缓存。

默认值1MB，一般够用，如果事务中包含二进制大对象或者大文本字段，那么缓存很快就会满并触发IO操作。

看看innodb_log_waits状态变量，如果不是0，增加此值。show status like "innodb_log_waits";

 

# **其他设置**

### query_cache_size

查询缓存是一个众所周知的瓶颈，甚至并发不多的时候也是如此。

最佳的选项是一开始就停用，设置为‘= 0’(5.6版本默认值)，并利用其它方法加速查询：优化索引、增加拷贝、分散负载或者启用额外存储(如memcache、redis)。

如果你已经启用并没有问题，那么说明此参数对你有用，此时再想停止需要小心。

 

### log_bin

如果你想让数据库充当备份节点，开启二进制日志是必须的。开启后，要设置server_id为一个唯一值。

就算只有一个服务器，如果想做基于时间点的数据恢复，开启二进制也很有用。

二进制日志一旦创建就永久保存，可以用PURGE BINARY LOGS来清除旧文件，或者设置expire_logs_days来指定过多少天日志被自动清除。

 

### skip_name_resolve

当客户端连接数据库时，服务器会进行主机名解析，并且当dns很慢时，建立连接也会慢。

因此建议启动服务器时关闭此选项。关闭后grant语句只能使用ip地址。所以在已有系统中要小心修改。
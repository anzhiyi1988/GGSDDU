把一个表copy到文件

copy test1 to '/data/test1.copy' with delimiter '|';

 

把一个文件数据复制到表中

copy test2 from  '/data/test1.copy' with delimiter '|';

 

命令行执行sql

atysql -h ip -d dbname -U dbusername -f  xxx.sql

 

建立非超级用户

create role anzhy login password 'anzhy' nosuperuser inherit createdb createrole replication;

 

把一个schema下的所有表赋予权限

grant all privileges on all tables in schema schemaname to username ;

 

查看当前登录用户

select current_user;

 

查看参数配置

show work_mem

set work_mem='10MB'   对当前会话有效

 

show shared_buffers

 

查看执行计划

explain analyze select ......

 

查询数据库当前连接数

select * from pg_stat_activity;

 

杀死连接数

方法一：

| **名称**                     | **返回类型** | **描述**               |
| ---------------------------- | ------------ | ---------------------- |
| pg_cancel_backend(pidint)    | boolean      | 取消一个后端的当前查询 |
| pg_terminate_backend(pidint) | boolean      | 终止一个后端服务进程   |

方法二：

在系统进程中找到对应的pid（ps -ef），然后kill掉。

 

查看当前系统的数据库信息

select * from pg_database;

 

查看数据库占用物理空间大小

select pg_database_size(dbname);

 

查看当前数据库中的sechema信息

select * from pg_namespace;

 

查看当前系统的所有表信息

select * from pg_class;

 

查看数据库拥有的用户信息

select * from pg_user;

select * from pg_roles;

select * from pg_authid;

 

查看已装数据库版本

select version();

 

查询数据库数据大小

select pg_size_pretty(pg_database_size('databasename'))

 

索引建立

CREATE INDEX i_ajxml_fy

  ON db_jcsj.t_ajxml

  USING btree

  (n_fy);

 

 

查询代理信息

information_schema.foreign_servers

information_schema.foreign_server_options

information_schema.foreign_tables

information_schema.foreign_table_options

aty_catalog.aty_foreign_server

aty_catalog.aty_foreign_table

aty_catalog.aty_extension

 

 

数据备份为sql文件,然后恢复

pg_dump -d db_xtgl -n db_xtgl -s > db_xtgl.dump

-s 的意思是只备份表结构,不要数据

psql -d pt_uim -f db_xtgl.dump -L temp.log